{% extends "mapentity/mapentity_form.html" %}
{% load i18n crispy_forms_tags mapentity_tags %}

{% block mainform %}
    <form id="mainform" action="{% if object.pk %}{{ object.get_update_url }}{% else %}{{ object.get_add_url }}{% endif %}" class="form-horizontal" method="POST">
    {% crispy form %}

        <fieldset class="formset">
            <h4>{% trans "Lines" %}</h4>
            {{ line_formset.management_form }}
            {% for line_form in line_formset %}
                <div class="form-row inline controls controls-row {{ line_formset.prefix }}">
                    {% crispy line_form %}
                </div>
            {% endfor %}
        </fieldset>
        <div  class="form-actions">
            <button id="save_changes" class="btn btn-success pull-right offset1" type="submit" form="mainform">
                <i class="icon-white icon-ok-sign"></i>
                Sauvegarder
            </button>
                <input type="button" name="cancel" value="{% trans 'Cancel' %}" class="btn pull-right offset1" id="button-id-cancel"/>
        </div>
    </form>
{% endblock mainform %}

{% block extrabody %}
    {{ block.super }}
    <script type="text/javascript">
                $('#id_date').datepicker({
                autoclose: true,
                language: '{{ request.LANGUAGE_CODE }}',
                format: window.SETTINGS.date_format
            });
        $(".clearfix").removeClass("clearfix");

        $(window).ready(function () {
            // TODO: do this with crispyforms !
            $('.form-row.inline.{{ line_formset.prefix }}').formset({
                prefix: '{{ line_formset.prefix }}',
                keepFieldValues: "[name='csrfmiddlewaretoken']",
                addCssClass: 'btn btn-success add-row',
                deleteCssClass: 'delete-row',
                addText: '{% trans "Add" %}',
                deleteText: '{% trans "Remove" %}',
            });
        });
    </script>
{% endblock extrabody %}